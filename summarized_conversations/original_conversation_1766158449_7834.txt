{'role': 'assistant', 'content': '\n<function_calls>\n<create-file file_path="./LawMatics.SDK.Tests/Clients/UsersClientTests.cs">\nusing System;\nusing System.Net;\nusing System.Net.Http;\nusing System.Text.Json;\nusing System.Threading;\nusing System.Threading.Tasks;\nusing LawMatics.SDK.Authentication;\nusing LawMatics.SDK.Clients;\nusing LawMatics.SDK.Configuration;\nusing LawMatics.SDK.Models;\nusing Microsoft.Extensions.Logging;\nusing Moq;\nusing Moq.Protected;\nusing Xunit;\n\nnamespace LawMatics.SDK.Tests.Clients\n{\n    /// <summary>\n    /// Unit tests for the <see cref="UsersClient"/> class.\n    /// </summary>\n    public class UsersClientTests : IDisposable\n    {\n        private readonly Mock<HttpMessageHandler> _mockHttpMessageHandler;\n        private readonly Mock<ILogger<UsersClient>> _mockLogger;\n        private readonly LawMaticsClientOptions _options;\n        private readonly LawMaticsCredentials _credentials;\n        private readonly HttpClient _httpClient;\n        private readonly UsersClient _client;\n\n        public UsersClientTests()\n        {\n            _mockHttpMessageHandler = new Mock<HttpMessageHandler>();\n            _mockLogger = new Mock<ILogger<UsersClient>>();\n            _options = new LawMaticsClientOptions\n            {\n                BaseUrl = "https://api.test.lawmatics.com",\n                ApiVersion = "v1",\n                TimeoutSeconds = 30\n            };\n            _credentials = new LawMaticsCredentials("test-access-token");\n            _httpClient = new HttpClient(_mockHttpMessageHandler.Object);\n            _client = new UsersClient(_httpClient, _options, _mockLogger.Object);\n        }\n\n        [Fact]\n        public async Task GetUsersAsync_WithValidResponse_ReturnsUsers()\n        {\n            // Arrange\n            var expectedResponse = new PagedResponse<User>\n            {\n                Data = new List<User>\n                {\n                    new User { Id = 1, FirstName = "John", LastName = "Doe", Email = "john@example.com", Role = "Attorney" },\n                    new User { Id = 2, FirstName = "Jane", LastName = "Smith", Email = "jane@example.com", Role = "Paralegal" }\n                },\n                Pagination = new PaginationInfo { Page = 1, PageSize = 10, TotalCount = 2 }\n            };\n            var responseJson = JsonSerializer.Serialize(expectedResponse);\n            var httpResponse = new HttpResponseMessage(HttpStatusCode.OK)\n            {\n                Content = new StringContent(responseJson, System.Text.Encoding.UTF8, "application/json")\n            };\n\n            _mockHttpMessageHandler\n                .Protected()\n                .Setup<Task<HttpResponseMessage>>(\n                    "SendAsync",\n                    ItExpr.IsAny<HttpRequestMessage>(),\n                    ItExpr.IsAny<CancellationToken>())\n                .ReturnsAsync(httpResponse);\n\n            // Act\n            var result = await _client.GetUsersAsync();\n\n            // Assert\n            Assert.NotNull(result);\n            Assert.NotNull(result.Data);\n            Assert.Equal(2, result.Data.Count);\n            Assert.Equal("John", result.Data[0].FirstName);\n            Assert.Equal("Doe", result.Data[0].LastName);\n            Assert.Equal("john@example.com", result.Data[0].Email);\n            Assert.Equal("Attorney", result.Data[0].Role);\n        }\n\n        [Fact]\n        public async Task GetUserAsync_WithValidId_ReturnsUser()\n        {\n            // Arrange\n            var expectedResponse = new ApiResponse<User>\n            {\n                Data = new User { Id = 1, FirstName = "John", LastName = "Doe", Email = "john@example.com", Role = "Attorney" }\n            };\n            var responseJson = JsonSerializer.Serialize(expectedResponse);\n            var httpResponse = new HttpResponseMessage(HttpStatusCode.OK)\n            {\n                Content = new StringContent(responseJson, System.Text.Encoding.UTF8, "application/json")\n            };\n\n            _mockHttpMessageHandler\n                .Protected()\n                .Setup<Task<HttpResponseMessage>>(\n                    "SendAsync",\n                    ItExpr.IsAny<HttpRequestMessage>(),\n                    ItExpr.IsAny<CancellationToken>())\n                .ReturnsAsync(httpResponse);\n\n            // Act\n            var result = await _client.GetUserAsync(1);\n\n            // Assert\n            Assert.NotNull(result);\n            Assert.NotNull(result.Data);\n            Assert.Equal(1, result.Data.Id);\n            Assert.Equal("John", result.Data.FirstName);\n            Assert.Equal("Doe", result.Data.LastName);\n            Assert.Equal("john@example.com", result.Data.Email);\n            Assert.Equal("Attorney", result.Data.Role);\n        }\n\n        [Fact]\n        public async Task CreateUserAsync_WithValidRequest_ReturnsCreatedUser()\n        {\n            // Arrange\n            var request = new CreateUserRequest\n            {\n                FirstName = "New",\n                LastName = "User",\n                Email = "newuser@example.com",\n                Role = "Attorney",\n                Phone = "555-1234",\n                Department = "Litigation"\n            };\n            var expectedResponse = new ApiResponse<User>\n            {\n                Data = new User \n                { \n                    Id = 1, \n                    FirstName = request.FirstName, \n                    LastName = request.LastName,\n                    Email = request.Email,\n                    Role = request.Role,\n                    Phone = request.Phone,\n                    Department = request.Department,\n                    IsActive = true,\n                    CreatedAt = DateTime.UtcNow\n                }\n            };\n            var responseJson = JsonSerializer.Serialize(expectedResponse);\n            var httpResponse = new HttpResponseMessage(HttpStatusCode.Created)\n            {\n                Content = new StringContent(responseJson, System.Text.Encoding.UTF8, "application/json")\n            };\n\n            _mockHttpMessageHandler\n                .Protected()\n                .Setup<Task<HttpResponseMessage>>(\n                    "SendAsync",\n                    ItExpr.IsAny<HttpRequestMessage>(),\n                    ItExpr.IsAny<CancellationToken>())\n                .ReturnsAsync(httpResponse);\n\n            // Act\n            var result = await _client.CreateUserAsync(request);\n\n            // Assert\n            Assert.NotNull(result);\n            Assert.NotNull(result.Data);\n            Assert.Equal(1, result.Data.Id);\n            Assert.Equal(request.FirstName, result.Data.FirstName);\n            Assert.Equal(request.LastName, result.Data.LastName);\n            Assert.Equal(request.Email, result.Data.Email);\n            Assert.Equal(request.Role, result.Data.Role);\n            Assert.Equal(request.Phone, result.Data.Phone);\n            Assert.Equal(request.Department, result.Data.Department);\n            Assert.True(result.Data.IsActive);\n        }\n\n        [Fact]\n        public async Task UpdateUserAsync_WithValidRequest_ReturnsUpdatedUser()\n        {\n            // Arrange\n            var request = new UpdateUserRequest\n            {\n                FirstName = "Updated",\n                LastName = "User",\n                Phone = "555-5678",\n                Department = "Corporate"\n            };\n            var expectedResponse = new ApiResponse<User>\n            {\n                Data = new User \n                { \n                    Id = 1, \n                    FirstName = request.FirstName, \n                    LastName = request.LastName,\n                    Phone = request.Phone,\n                    Department = request.Department,\n                    UpdatedAt = DateTime.UtcNow\n                }\n            };\n            var responseJson = JsonSerializer.Serialize(expectedResponse);\n            var httpResponse = new HttpResponseMessage(HttpStatusCode.OK)\n            {\n                Content = new StringContent(responseJson, System.Text.Encoding.UTF8, "application/json")\n            };\n\n            _mockHttpMessageHandler\n                .Protected()\n                .Setup<Task<HttpResponseMessage>>(\n                    "SendAsync",\n                    ItExpr.IsAny<HttpRequestMessage>(),\n                    ItExpr.IsAny<CancellationToken>())\n                .ReturnsAsync(httpResponse);\n\n            // Act\n            var result = await _client.UpdateUserAsync(1, request);\n\n            // Assert\n            Assert.NotNull(result);\n            Assert.NotNull(result.Data);\n            Assert.Equal(1, result.Data.Id);\n            Assert.Equal(request.FirstName, result.Data.FirstName);\n            Assert.Equal(request.LastName, result.Data.LastName);\n            Assert.Equal(request.Phone, result.Data.Phone);\n            Assert.Equal(request.Department, result.Data.Department);\n        }\n\n        [Fact]\n        public async Task DeleteUserAsync_WithValidId_ReturnsSuccessResponse()\n        {\n            // Arrange\n            var expectedResponse = new ApiResponse<object> { Data = null };\n            var responseJson = JsonSerializer.Serialize(expectedResponse);\n            var httpResponse = new HttpResponseMessage(HttpStatusCode.NoContent)\n            {\n                Content = new StringContent(responseJson, System.Text.Encoding.UTF8, "application/json")\n            };\n\n            _mockHttpMessageHandler\n                .Protected()\n                .Setup<Task<HttpResponseMessage>>(\n                    "SendAsync",\n                    ItExpr.IsAny<HttpRequestMessage>(),\n                    ItExpr.IsAny<CancellationToken>())\n                .ReturnsAsync(httpResponse);\n\n            // Act\n            var result = await _client.DeleteUserAsync(1);\n\n            // Assert\n            Assert.NotNull(result);\n        }\n\n        [Fact]\n        public async Task GetUsersByRoleAsync_WithRole_ReturnsFilteredUsers()\n        {\n            // Arrange\n            var role = "Attorney";\n            var expectedResponse = new PagedResponse<User>\n            {\n                Data = new List<User>\n                {\n                    new User { Id = 1, FirstName = "John", LastName = "Doe", Email = "john@example.com", Role = role },\n                    new User { Id = 2, FirstName = "Jane", LastName = "Smith", Email = "jane@example.com", Role = role }\n                },\n                Pagination = new PaginationInfo { Page = 1, PageSize = 10, TotalCount = 2 }\n            };\n            var responseJson = JsonSerializer.Serialize(expectedResponse);\n            var httpResponse = new HttpResponseMessage(HttpStatusCode.OK)\n            {\n                Content = new StringContent(responseJson, System.Text.Encoding.UTF8, "application/json")\n            };\n\n            _mockHttpMessageHandler\n                .Protected()\n                .Setup<Task<HttpResponseMessage>>(\n                    "SendAsync",\n                    ItExpr.IsAny<HttpRequestMessage>(),\n                    ItExpr.IsAny<CancellationToken>())\n                .ReturnsAsync(httpResponse);\n\n            // Act\n            var result = await _client.GetUsersByRoleAsync(role);\n\n            // Assert\n            Assert.NotNull(result);\n            Assert.NotNull(result.Data);\n            Assert.Equal(2, result.Data.Count);\n            Assert.All(result.Data, user => Assert.Equal(role, user.Role));\n        }\n\n        [Fact]\n        public async Task GetUsersByDepartmentAsync_WithDepartment_ReturnsFilteredUsers()\n        {\n            // Arrange\n            var department = "Litigation";\n            var expectedResponse = new PagedResponse<User>\n            {\n                Data = new List<User>\n                {\n                    new User { Id = 1, FirstName = "John", LastName = "Doe", Department = department, Role = "Attorney" },\n                    new User { Id = 2, FirstName = "Jane", LastName = "Smith", Department = department, Role = "Paralegal" }\n                },\n                Pagination = new PaginationInfo { Page = 1, PageSize = 10, TotalCount = 2 }\n            };\n            var responseJson = JsonSerializer.Serialize(expectedResponse);\n            var httpResponse = new HttpResponseMessage(HttpStatusCode.OK)\n            {\n                Content = new StringContent(responseJson, System.Text.Encoding.UTF8, "application/json")\n            };\n\n            _mockHttpMessageHandler\n                .Protected()\n                .Setup<Task<HttpResponseMessage>>(\n                    "SendAsync",\n                    ItExpr.IsAny<HttpRequestMessage>(),\n                    ItExpr.IsAny<CancellationToken>())\n                .ReturnsAsync(httpResponse);\n\n            // Act\n            var result = await _client.GetUsersByDepartmentAsync(department);\n\n            // Assert\n            Assert.NotNull(result);\n            Assert.NotNull(result.Data);\n            Assert.Equal(2, result.Data.Count);\n            Assert.All(result.Data, user => Assert.Equal(department, user.Department));\n        }\n\n        [Fact]\n        public async Task GetActiveUsersAsync_ReturnsActiveUsers()\n        {\n            // Arrange\n            var expectedResponse = new PagedResponse<User>\n            {\n                Data = new List<User>\n                {\n                    new User { Id = 1, FirstName = "John", LastName = "Doe", IsActive = true },\n                    new User { Id = 2, FirstName = "Jane", LastName = "Smith", IsActive = true }\n                },\n                Pagination = new PaginationInfo { Page = 1, PageSize = 10, TotalCount = 2 }\n            };\n            var responseJson = JsonSerializer.Serialize(expectedResponse);\n            var httpResponse = new HttpResponseMessage(HttpStatusCode.OK)\n            {\n                Content = new StringContent(responseJson, System.Text.Encoding.UTF8, "application/json")\n            };\n\n            _mockHttpMessageHandler\n                .Protected()\n                .Setup<Task<HttpResponseMessage>>(\n                    "SendAsync",\n                    ItExpr.IsAny<HttpRequestMessage>(),\n                    ItExpr.IsAny<CancellationToken>())\n                .ReturnsAsync(httpResponse);\n\n            // Act\n            var result = await _client.GetActiveUsersAsync();\n\n            // Assert\n            Assert.NotNull(result);\n            Assert.NotNull(result.Data);\n            Assert.Equal(2, result.Data.Count);\n            Assert.All(result.Data, user => Assert.True(user.IsActive));\n        }\n\n        [Fact]\n        public async Task DeactivateUserAsync_WithValidId_ReturnsUpdatedUser()\n        {\n            // Arrange\n            var userId = 1;\n            var expectedResponse = new ApiResponse<User>\n            {\n                Data = new User { Id = userId, FirstName = "John", LastName = "Doe", IsActive = false, DeactivatedAt = DateTime.UtcNow }\n            };\n            var responseJson = JsonSerializer.Serialize(expectedResponse);\n            var httpResponse = new HttpResponseMessage(HttpStatusCode.OK)\n            {\n                Content = new StringContent(responseJson, System.Text.Encoding.UTF8, "application/json")\n            };\n\n            _mockHttpMessageHandler\n                .Protected()\n                .Setup<Task<HttpResponseMessage>>(\n                    "SendAsync",\n                    ItExpr.IsAny<HttpRequestMessage>(),\n                    ItExpr.IsAny<CancellationToken>())\n                .ReturnsAsync(httpResponse);\n\n            // Act\n            var result = await _client.DeactivateUserAsync(userId);\n\n            // Assert\n            Assert.NotNull(result);\n            Assert.NotNull(result.Data);\n            Assert.Equal(userId, result.Data.Id);\n            Assert.False(result.Data.IsActive);\n        }\n\n        [Fact]\n        public async Task ActivateUserAsync_WithValidId_ReturnsUpdatedUser()\n        {\n            // Arrange\n            var userId = 1;\n            var expectedResponse = new ApiResponse<User>\n            {\n                Data = new User { Id = userId, FirstName = "John", LastName = "Doe", IsActive = true, ActivatedAt = DateTime.UtcNow }\n            };\n            var responseJson = JsonSerializer.Serialize(expectedResponse);\n            var httpResponse = new HttpResponseMessage(HttpStatusCode.OK)\n            {\n                Content = new StringContent(responseJson, System.Text.Encoding.UTF8, "application/json")\n            };\n\n            _mockHttpMessageHandler\n                .Protected()\n                .Setup<Task<HttpResponseMessage>>(\n                    "SendAsync",\n                    ItExpr.IsAny<HttpRequestMessage>(),\n                    ItExpr.IsAny<CancellationToken>())\n                .ReturnsAsync(httpResponse);\n\n            // Act\n            var result = await _client.ActivateUserAsync(userId);\n\n            // Assert\n            Assert.NotNull(result);\n            Assert.NotNull(result.Data);\n            Assert.Equal(userId, result.Data.Id);\n            Assert.True(result.Data.IsActive);\n        }\n\n        public void Dispose()\n        {\n            _httpClient?.Dispose();\n            _client?.Dispose();\n        }\n    }\n}\n</create-file>\n</function_calls>'}