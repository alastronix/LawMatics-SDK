{'role': 'assistant', 'content': '\nExcellent! Now let me start creating comprehensive unit tests. I\'ll begin with tests for the core LawMaticsClient class.\n\n<function_calls>\n<create-file file_path="LawMatics.SDK.Tests/LawMaticsClientTests.cs">\nusing System;\nusing System.Net;\nusing System.Net.Http;\nusing System.Text.Json;\nusing System.Threading;\nusing System.Threading.Tasks;\nusing LawMatics.SDK.Authentication;\nusing LawMatics.SDK.Configuration;\nusing LawMatics.SDK.Exceptions;\nusing LawMatics.SDK.Models;\nusing Microsoft.Extensions.Logging;\nusing Moq;\nusing Moq.Protected;\nusing Xunit;\n\nnamespace LawMatics.SDK.Tests\n{\n    /// <summary>\n    /// Unit tests for the <see cref="LawMaticsClient"/> class.\n    /// </summary>\n    public class LawMaticsClientTests : IDisposable\n    {\n        private readonly Mock<HttpMessageHandler> _mockHttpMessageHandler;\n        private readonly HttpClient _httpClient;\n        private readonly Mock<ILogger<LawMaticsClient>> _mockLogger;\n        private readonly LawMaticsClientOptions _options;\n        private readonly LawMaticsCredentials _credentials;\n\n        public LawMaticsClientTests()\n        {\n            _mockHttpMessageHandler = new Mock<HttpMessageHandler>();\n            _httpClient = new HttpClient(_mockHttpMessageHandler.Object);\n            _mockLogger = new Mock<ILogger<LawMaticsClient>>();\n            _options = new LawMaticsClientOptions\n            {\n                BaseUrl = "https://api.test.lawmatics.com",\n                ApiVersion = "v1",\n                TimeoutSeconds = 30\n            };\n            _credentials = new LawMaticsCredentials("test-access-token")\n            {\n                ClientId = "test-client-id",\n                ClientSecret = "test-client-secret",\n                RefreshToken = "test-refresh-token"\n            };\n        }\n\n        [Fact]\n        public void Constructor_WithNullCredentials_ThrowsArgumentNullException()\n        {\n            // Act & Assert\n            Assert.Throws<ArgumentNullException>(() => new LawMaticsClient(null!, _options, _mockLogger.Object));\n        }\n\n        [Fact]\n        public void Constructor_WithNullOptions_UsesDefaultOptions()\n        {\n            // Act\n            using var client = new LawMaticsClient(_credentials, null, _mockLogger.Object);\n\n            // Assert\n            Assert.NotNull(client);\n        }\n\n        [Fact]\n        public void Constructor_WithNullLogger_UsesNullLogger()\n        {\n            // Act\n            using var client = new LawMaticsClient(_credentials, _options, null);\n\n            // Assert\n            Assert.NotNull(client);\n        }\n\n        [Fact]\n        public void Constructor_WithInvalidBaseUrl_ThrowsArgumentException()\n        {\n            // Arrange\n            var invalidOptions = new LawMaticsClientOptions\n            {\n                BaseUrl = "invalid-url"\n            };\n\n            // Act & Assert\n            Assert.Throws<ArgumentException>(() => new LawMaticsClient(_credentials, invalidOptions, _mockLogger.Object));\n        }\n\n        [Fact]\n        public void Constructor_WithNegativeTimeout_ThrowsArgumentException()\n        {\n            // Arrange\n            var invalidOptions = new LawMaticsClientOptions\n            {\n                TimeoutSeconds = -1\n            };\n\n            // Act & Assert\n            Assert.Throws<ArgumentException>(() => new LawMaticsClient(_credentials, invalidOptions, _mockLogger.Object));\n        }\n\n        [Fact]\n        public void Constructor_WithValidParameters_SetsUpAuthenticationHeader()\n        {\n            // Act\n            using var client = new LawMaticsClient(_credentials, _options, _mockLogger.Object);\n\n            // Assert\n            Assert.Equal("Bearer", _httpClient.DefaultRequestHeaders.Authorization?.Scheme);\n            Assert.Equal("test-access-token", _httpClient.DefaultRequestHeaders.Authorization?.Parameter);\n        }\n\n        [Fact]\n        public void UpdateCredentials_WithNullCredentials_ThrowsArgumentNullException()\n        {\n            // Arrange\n            using var client = new LawMaticsClient(_credentials, _options, _mockLogger.Object);\n\n            // Act & Assert\n            Assert.Throws<ArgumentNullException>(() => client.UpdateCredentials(null!));\n        }\n\n        [Fact]\n        public void UpdateCredentials_WithValidCredentials_UpdatesAuthenticationHeader()\n        {\n            // Arrange\n            using var client = new LawMaticsClient(_credentials, _options, _mockLogger.Object);\n            var newCredentials = new LawMaticsCredentials("new-access-token");\n\n            // Act\n            client.UpdateCredentials(newCredentials);\n\n            // Assert\n            Assert.Equal("Bearer", _httpClient.DefaultRequestHeaders.Authorization?.Scheme);\n            Assert.Equal("new-access-token", _httpClient.DefaultRequestHeaders.Authorization?.Parameter);\n        }\n\n        [Fact]\n        public async Task GetAsync_WithSuccessfulResponse_ReturnsDeserializedData()\n        {\n            // Arrange\n            var expectedData = new { Id = 1, Name = "Test" };\n            var responseJson = JsonSerializer.Serialize(expectedData);\n            var response = new HttpResponseMessage(HttpStatusCode.OK)\n            {\n                Content = new StringContent(responseJson)\n            };\n\n            _mockHttpMessageHandler\n                .Protected()\n                .Setup<Task<HttpResponseMessage>>(\n                    "SendAsync",\n                    ItExpr.IsAny<HttpRequestMessage>(),\n                    ItExpr.IsAny<CancellationToken>())\n                .ReturnsAsync(response);\n\n            using var client = new LawMaticsClient(_credentials, _httpClient, _options, _mockLogger.Object);\n\n            // Act\n            var result = await client.GetAsync<object>("test-endpoint");\n\n            // Assert\n            Assert.NotNull(result);\n            _mockHttpMessageHandler\n                .Protected()\n                .Verify(\n                    "SendAsync",\n                    Times.Once(),\n                    ItExpr.Is<HttpRequestMessage>(req => req.Method == HttpMethod.Get && req.RequestUri?.ToString().Contains("test-endpoint") == true),\n                    ItExpr.IsAny<CancellationToken>());\n        }\n\n        [Fact]\n        public async Task GetAsync_WithNotFoundResponse_ThrowsLawMaticsNotFoundException()\n        {\n            // Arrange\n            var response = new HttpResponseMessage(HttpStatusCode.NotFound);\n\n            _mockHttpMessageHandler\n                .Protected()\n                .Setup<Task<HttpResponseMessage>>(\n                    "SendAsync",\n                    ItExpr.IsAny<HttpRequestMessage>(),\n                    ItExpr.IsAny<CancellationToken>())\n                .ReturnsAsync(response);\n\n            using var client = new LawMaticsClient(_credentials, _httpClient, _options, _mockLogger.Object);\n\n            // Act & Assert\n            var exception = await Assert.ThrowsAsync<LawMaticsNotFoundException>(\n                () => client.GetAsync<object>("test-endpoint"));\n            \n            Assert.Equal(404, exception.StatusCode);\n        }\n\n        [Fact]\n        public async Task GetAsync_WithUnauthorizedResponse_ThrowsLawMaticsAuthenticationException()\n        {\n            // Arrange\n            var response = new HttpResponseMessage(HttpStatusCode.Unauthorized);\n\n            _mockHttpMessageHandler\n                .Protected()\n                .Setup<Task<HttpResponseMessage>>(\n                    "SendAsync",\n                    ItExpr.IsAny<HttpRequestMessage>(),\n                    ItExpr.IsAny<CancellationToken>())\n                .ReturnsAsync(response);\n\n            using var client = new LawMaticsClient(_credentials, _httpClient, _options, _mockLogger.Object);\n\n            // Act & Assert\n            var exception = await Assert.ThrowsAsync<LawMaticsAuthenticationException>(\n                () => client.GetAsync<object>("test-endpoint"));\n            \n            Assert.Equal(401, exception.StatusCode);\n        }\n\n        [Fact]\n        public async Task GetAsync_WithTooManyRequestsResponse_ThrowsLawMaticsRateLimitException()\n        {\n            // Arrange\n            var response = new HttpResponseMessage(HttpStatusCode.TooManyRequests);\n\n            _mockHttpMessageHandler\n                .Protected()\n                .Setup<Task<HttpResponseMessage>>(\n                    "SendAsync",\n                    ItExpr.IsAny<HttpRequestMessage>(),\n                    ItExpr.IsAny<CancellationToken>())\n                .ReturnsAsync(response);\n\n            using var client = new LawMaticsClient(_credentials, _httpClient, _options, _mockLogger.Object);\n\n            // Act & Assert\n            var exception = await Assert.ThrowsAsync<LawMaticsRateLimitException>(\n                () => client.GetAsync<object>("test-endpoint"));\n            \n            Assert.Equal(429, exception.StatusCode);\n        }\n\n        [Fact]\n        public async Task GetAsync_WithInternalServerError_ThrowsLawMaticsApiException()\n        {\n            // Arrange\n            var response = new HttpResponseMessage(HttpStatusCode.InternalServerError);\n\n            _mockHttpMessageHandler\n                .Protected()\n                .Setup<Task<HttpResponseMessage>>(\n                    "SendAsync",\n                    ItExpr.IsAny<HttpRequestMessage>(),\n                    ItExpr.IsAny<CancellationToken>())\n                .ReturnsAsync(response);\n\n            using var client = new LawMaticsClient(_credentials, _httpClient, _options, _mockLogger.Object);\n\n            // Act & Assert\n            var exception = await Assert.ThrowsAsync<LawMaticsApiException>(\n                () => client.GetAsync<object>("test-endpoint"));\n            \n            Assert.Equal(500, exception.StatusCode);\n        }\n\n        [Fact]\n        public async Task PostAsync_WithSuccessfulResponse_ReturnsDeserializedData()\n        {\n            // Arrange\n            var requestData = new { Name = "Test" };\n            var expectedData = new { Id = 1, Name = "Test" };\n            var responseJson = JsonSerializer.Serialize(expectedData);\n            var response = new HttpResponseMessage(HttpStatusCode.OK)\n            {\n                Content = new StringContent(responseJson)\n            };\n\n            _mockHttpMessageHandler\n                .Protected()\n                .Setup<Task<HttpResponseMessage>>(\n                    "SendAsync",\n                    ItExpr.IsAny<HttpRequestMessage>(),\n                    ItExpr.IsAny<CancellationToken>())\n                .ReturnsAsync(response);\n\n            using var client = new LawMaticsClient(_credentials, _httpClient, _options, _mockLogger.Object);\n\n            // Act\n            var result = await client.PostAsync<object>("test-endpoint", requestData);\n\n            // Assert\n            Assert.NotNull(result);\n            _mockHttpMessageHandler\n                .Protected()\n                .Verify(\n                    "SendAsync",\n                    Times.Once(),\n                    ItExpr.Is<HttpRequestMessage>(req => \n                        req.Method == HttpMethod.Post && \n                        req.RequestUri?.ToString().Contains("test-endpoint") == true &&\n                        req.Content != null),\n                    ItExpr.IsAny<CancellationToken>());\n        }\n\n        [Fact]\n        public async Task PutAsync_WithSuccessfulResponse_ReturnsDeserializedData()\n        {\n            // Arrange\n            var requestData = new { Name = "Updated Test" };\n            var expectedData = new { Id = 1, Name = "Updated Test" };\n            var responseJson = JsonSerializer.Serialize(expectedData);\n            var response = new HttpResponseMessage(HttpStatusCode.OK)\n            {\n                Content = new StringContent(responseJson)\n            };\n\n            _mockHttpMessageHandler\n                .Protected()\n                .Setup<Task<HttpResponseMessage>>(\n                    "SendAsync",\n                    ItExpr.IsAny<HttpRequestMessage>(),\n                    ItExpr.IsAny<CancellationToken>())\n                .ReturnsAsync(response);\n\n            using var client = new LawMaticsClient(_credentials, _httpClient, _options, _mockLogger.Object);\n\n            // Act\n            var result = await client.PutAsync<object>("test-endpoint", requestData);\n\n            // Assert\n            Assert.NotNull(result);\n            _mockHttpMessageHandler\n                .Protected()\n                .Verify(\n                    "SendAsync",\n                    Times.Once(),\n                    ItExpr.Is<HttpRequestMessage>(req => \n                        req.Method == HttpMethod.Put && \n                        req.RequestUri?.ToString().Contains("test-endpoint") == true &&\n                        req.Content != null),\n                    ItExpr.IsAny<CancellationToken>());\n        }\n\n        [Fact]\n        public async Task DeleteAsync_WithSuccessfulResponse_ReturnsDeserializedData()\n        {\n            // Arrange\n            var response = new HttpResponseMessage(HttpStatusCode.NoContent);\n\n            _mockHttpMessageHandler\n                .Protected()\n                .Setup<Task<HttpResponseMessage>>(\n                    "SendAsync",\n                    ItExpr.IsAny<HttpRequestMessage>(),\n                    ItExpr.IsAny<CancellationToken>())\n                .ReturnsAsync(response);\n\n            using var client = new LawMaticsClient(_credentials, _httpClient, _options, _mockLogger.Object);\n\n            // Act\n            var result = await client.DeleteAsync<object>("test-endpoint");\n\n            // Assert\n            _mockHttpMessageHandler\n                .Protected()\n                .Verify(\n                    "SendAsync",\n                    Times.Once(),\n                    ItExpr.Is<HttpRequestMessage>(req => \n                        req.Method == HttpMethod.Delete && \n                        req.RequestUri?.ToString().Contains("test-endpoint") == true),\n                    ItExpr.IsAny<CancellationToken>());\n        }\n\n        [Fact]\n        public void Dispose_DisposesHttpClient()\n        {\n            // Arrange\n            var handler = new Mock<HttpMessageHandler>();\n            var httpClient = new HttpClient(handler.Object);\n            using var client = new LawMaticsClient(_credentials, httpClient, _options, _mockLogger.Object);\n\n            // Act\n            client.Dispose();\n\n            // Assert - If we reach here without exceptions, the disposal was successful\n            // Note: HttpClient disposal doesn\'t have a direct way to verify, but this test ensures no exceptions are thrown\n        }\n\n        [Fact]\n        public async Task GetAsync_WithHttpRequestException_ThrowsLawMaticsException()\n        {\n            // Arrange\n            _mockHttpMessageHandler\n                .Protected()\n                .Setup<Task<HttpResponseMessage>>(\n                    "SendAsync",\n                    ItExpr.IsAny<HttpRequestMessage>(),\n                    ItExpr.IsAny<CancellationToken>())\n                .ThrowsAsync(new HttpRequestException("Network error"));\n\n            using var client = new LawMaticsClient(_credentials, _httpClient, _options, _mockLogger.Object);\n\n            // Act & Assert\n            var exception = await Assert.ThrowsAsync<LawMaticsException>(\n                () => client.GetAsync<object>("test-endpoint"));\n            \n            Assert.Contains("HTTP request failed", exception.Message);\n            Assert.IsType<HttpRequestException>(exception.InnerException);\n        }\n\n        [Fact]\n        public async Task GetAsync_WithTaskCanceledException_ThrowsLawMaticsException()\n        {\n            // Arrange\n            _mockHttpMessageHandler\n                .Protected()\n                .Setup<Task<HttpResponseMessage>>(\n                    "SendAsync",\n                    ItExpr.IsAny<HttpRequestMessage>(),\n                    ItExpr.IsAny<CancellationToken>())\n                .ThrowsAsync(new TaskCanceledException("Request timed out"));\n\n            using var client = new LawMaticsClient(_credentials, _httpClient, _options, _mockLogger.Object);\n\n            // Act & Assert\n            var exception = await Assert.ThrowsAsync<LawMaticsException>(\n                () => client.GetAsync<object>("test-endpoint"));\n            \n            Assert.Contains("timed out", exception.Message);\n            Assert.IsType<TaskCanceledException>(exception.InnerException);\n        }\n\n        public void Dispose()\n        {\n            _httpClient?.Dispose();\n        }\n    }\n}\n</create-file>\n</function_calls>'}