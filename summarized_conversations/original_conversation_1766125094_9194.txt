{'role': 'assistant', 'content': '\nNow let me create the main LawMaticsClient class that will serve as the entry point for the SDK.\n\n<function_calls>\n<create-file file_path="LawMatics.SDK/LawMaticsClient.cs">\nusing System;\nusing System.Collections.Generic;\nusing System.Net.Http;\nusing System.Net.Http.Headers;\nusing System.Text;\nusing System.Text.Json;\nusing System.Threading;\nusing System.Threading.Tasks;\nusing LawMatics.SDK.Authentication;\nusing LawMatics.SDK.Configuration;\nusing LawMatics.SDK.Exceptions;\nusing LawMatics.SDK.Models;\nusing Microsoft.Extensions.Logging;\nusing Microsoft.Extensions.Logging.Abstractions;\n\nnamespace LawMatics.SDK\n{\n    /// <summary>\n    /// The main client for interacting with the LawMatics API.\n    /// </summary>\n    public class LawMaticsClient : IDisposable\n    {\n        private readonly HttpClient _httpClient;\n        private readonly LawMaticsClientOptions _options;\n        private readonly ILogger<LawMaticsClient> _logger;\n        private readonly JsonSerializerOptions _jsonOptions;\n        private bool _disposed;\n\n        /// <summary>\n        /// Gets the authentication credentials.\n        /// </summary>\n        public LawMaticsCredentials Credentials { get; private set; }\n\n        /// <summary>\n        /// Gets the contacts client for managing contacts.\n        /// </summary>\n        public Clients.ContactsClient Contacts { get; }\n\n        /// <summary>\n        /// Gets the companies client for managing companies.\n        /// </summary>\n        public Clients.CompaniesClient Companies { get; }\n\n        /// <summary>\n        /// Gets the matters client for managing matters (prospects).\n        /// </summary>\n        public Clients.MattersClient Matters { get; }\n\n        /// <summary>\n        /// Gets the events client for managing events (appointments).\n        /// </summary>\n        public Clients.EventsClient Events { get; }\n\n        /// <summary>\n        /// Gets the files client for managing files.\n        /// </summary>\n        public Clients.FilesClient Files { get; }\n\n        /// <summary>\n        /// Gets the folders client for managing folders.\n        /// </summary>\n        public Clients.FoldersClient Folders { get; }\n\n        /// <summary>\n        /// Gets the email campaigns client for managing email campaigns.\n        /// </summary>\n        public Clients.EmailCampaignsClient EmailCampaigns { get; }\n\n        /// <summary>\n        /// Gets the payments client for managing payments and invoices.\n        /// </summary>\n        public Clients.PaymentsClient Payments { get; }\n\n        /// <summary>\n        /// Gets the custom fields client for managing custom fields.\n        /// </summary>\n        public Clients.CustomFieldsClient CustomFields { get; }\n\n        /// <summary>\n        /// Gets the custom forms client for managing custom forms.\n        /// </summary>\n        public Clients.CustomFormsClient CustomForms { get; }\n\n        /// <summary>\n        /// Gets the notes client for managing notes.\n        /// </summary>\n        public Clients.NotesClient Notes { get; }\n\n        /// <summary>\n        /// Gets the users client for managing users.\n        /// </summary>\n        public Clients.UsersClient Users { get; }\n\n        /// <summary>\n        /// Initializes a new instance of the <see cref="LawMaticsClient"/> class.\n        /// </summary>\n        /// <param name="credentials">The authentication credentials.</param>\n        /// <param name="options">The client configuration options.</param>\n        /// <param name="logger">The logger instance.</param>\n        public LawMaticsClient(LawMaticsCredentials credentials, LawMaticsClientOptions? options = null, ILogger<LawMaticsClient>? logger = null)\n        {\n            Credentials = credentials ?? throw new ArgumentNullException(nameof(credentials));\n            _options = options ?? LawMaticsClientOptions.Default;\n            _logger = logger ?? NullLogger<LawMaticsClient>.Instance;\n\n            _options.Validate();\n            \n            _httpClient = new HttpClient\n            {\n                Timeout = TimeSpan.FromSeconds(_options.TimeoutSeconds),\n                BaseAddress = new Uri(_options.BaseUrl)\n            };\n\n            _httpClient.DefaultRequestHeaders.Add("User-Agent", _options.UserAgent);\n\n            // Add custom headers\n            foreach (var header in _options.CustomHeaders)\n            {\n                _httpClient.DefaultRequestHeaders.TryAddWithoutValidation(header.Key, header.Value);\n            }\n\n            _jsonOptions = new JsonSerializerOptions\n            {\n                PropertyNamingPolicy = JsonNamingPolicy.SnakeCaseLower,\n                DefaultIgnoreCondition = System.Text.Json.Serialization.JsonIgnoreCondition.WhenWritingNull,\n                Converters = { new System.Text.Json.Serialization.JsonStringEnumConverter() }\n            };\n\n            // Initialize API clients\n            Contacts = new Clients.ContactsClient(this);\n            Companies = new Clients.CompaniesClient(this);\n            Matters = new Clients.MattersClient(this);\n            Events = new Clients.EventsClient(this);\n            Files = new Clients.FilesClient(this);\n            Folders = new Clients.FoldersClient(this);\n            EmailCampaigns = new Clients.EmailCampaignsClient(this);\n            Payments = new Clients.PaymentsClient(this);\n            CustomFields = new Clients.CustomFieldsClient(this);\n            CustomForms = new Clients.CustomFormsClient(this);\n            Notes = new Clients.NotesClient(this);\n            Users = new Clients.UsersClient(this);\n\n            // Set up authentication\n            SetupAuthentication();\n        }\n\n        /// <summary>\n        /// Initializes a new instance of the <see cref="LawMaticsClient"/> class with a custom HttpClient.\n        /// </summary>\n        /// <param name="credentials">The authentication credentials.</param>\n        /// <param name="httpClient">The HttpClient instance to use.</param>\n        /// <param name="options">The client configuration options.</param>\n        /// <param name="logger">The logger instance.</param>\n        public LawMaticsClient(LawMaticsCredentials credentials, HttpClient httpClient, LawMaticsClientOptions? options = null, ILogger<LawMaticsClient>? logger = null)\n        {\n            Credentials = credentials ?? throw new ArgumentNullException(nameof(credentials));\n            _httpClient = httpClient ?? throw new ArgumentNullException(nameof(httpClient));\n            _options = options ?? LawMaticsClientOptions.Default;\n            _logger = logger ?? NullLogger<LawMaticsClient>.Instance;\n\n            _options.Validate();\n\n            _jsonOptions = new JsonSerializerOptions\n            {\n                PropertyNamingPolicy = JsonNamingPolicy.SnakeCaseLower,\n                DefaultIgnoreCondition = System.Text.Json.Serialization.JsonIgnoreCondition.WhenWritingNull,\n                Converters = { new System.Text.Json.Serialization.JsonStringEnumConverter() }\n            };\n\n            // Initialize API clients\n            Contacts = new Clients.ContactsClient(this);\n            Companies = new Clients.CompaniesClient(this);\n            Matters = new Clients.MattersClient(this);\n            Events = new Clients.EventsClient(this);\n            Files = new Clients.FilesClient(this);\n            Folders = new Clients.FoldersClient(this);\n            EmailCampaigns = new Clients.EmailCampaignsClient(this);\n            Payments = new Clients.PaymentsClient(this);\n            CustomFields = new Clients.CustomFieldsClient(this);\n            CustomForms = new Clients.CustomFormsClient(this);\n            Notes = new Clients.NotesClient(this);\n            Users = new Clients.UsersClient(this);\n\n            // Set up authentication\n            SetupAuthentication();\n        }\n\n        /// <summary>\n        /// Updates the authentication credentials.\n        /// </summary>\n        /// <param name="credentials">The new authentication credentials.</param>\n        public void UpdateCredentials(LawMaticsCredentials credentials)\n        {\n            Credentials = credentials ?? throw new ArgumentNullException(nameof(credentials));\n            SetupAuthentication();\n        }\n\n        /// <summary>\n        /// Refreshes the access token using the refresh token.\n        /// </summary>\n        /// <param name="cancellationToken">The cancellation token.</param>\n        /// <returns>A task representing the asynchronous operation.</returns>\n        /// <exception cref="LawMaticsAuthenticationException">Thrown when token refresh fails.</exception>\n        public async Task RefreshTokenAsync(CancellationToken cancellationToken = default)\n        {\n            if (!Credentials.HasRefreshToken)\n            {\n                throw new LawMaticsAuthenticationException("No refresh token available for token refresh.");\n            }\n\n            try\n            {\n                var tokenResponse = await RefreshTokenInternalAsync(cancellationToken);\n                Credentials.UpdateToken(tokenResponse.AccessToken, tokenResponse.RefreshToken, tokenResponse.ExpiresIn);\n                SetupAuthentication();\n\n                _logger.LogInformation("Successfully refreshed access token.");\n            }\n            catch (Exception ex)\n            {\n                _logger.LogError(ex, "Failed to refresh access token.");\n                throw new LawMaticsAuthenticationException("Failed to refresh access token.", ex);\n            }\n        }\n\n        /// <summary>\n        /// Makes an HTTP GET request to the specified endpoint.\n        /// </summary>\n        /// <typeparam name="T">The expected response type.</typeparam>\n        /// <param name="endpoint">The API endpoint.</param>\n        /// <param name="cancellationToken">The cancellation token.</param>\n        /// <returns>The deserialized response.</returns>\n        /// <exception cref="LawMaticsException">Thrown when the request fails.</exception>\n        public async Task<T> GetAsync<T>(string endpoint, CancellationToken cancellationToken = default)\n        {\n            return await SendRequestAsync<T>(HttpMethod.Get, endpoint, null, cancellationToken);\n        }\n\n        /// <summary>\n        /// Makes an HTTP POST request to the specified endpoint.\n        /// </summary>\n        /// <typeparam name="T">The expected response type.</typeparam>\n        /// <param name="endpoint">The API endpoint.</param>\n        /// <param name="content">The request content.</param>\n        /// <param name="cancellationToken">The cancellation token.</param>\n        /// <returns>The deserialized response.</returns>\n        /// <exception cref="LawMaticsException">Thrown when the request fails.</exception>\n        public async Task<T> PostAsync<T>(string endpoint, object? content, CancellationToken cancellationToken = default)\n        {\n            return await SendRequestAsync<T>(HttpMethod.Post, endpoint, content, cancellationToken);\n        }\n\n        /// <summary>\n        /// Makes an HTTP PUT request to the specified endpoint.\n        /// </summary>\n        /// <typeparam name="T">The expected response type.</typeparam>\n        /// <param name="endpoint">The API endpoint.</param>\n        /// <param name="content">The request content.</param>\n        /// <param name="cancellationToken">The cancellation token.</param>\n        /// <returns>The deserialized response.</returns>\n        /// <exception cref="LawMaticsException">Thrown when the request fails.</exception>\n        public async Task<T> PutAsync<T>(string endpoint, object? content, CancellationToken cancellationToken = default)\n        {\n            return await SendRequestAsync<T>(HttpMethod.Put, endpoint, content, cancellationToken);\n        }\n\n        /// <summary>\n        /// Makes an HTTP DELETE request to the specified endpoint.\n        /// </summary>\n        /// <typeparam name="T">The expected response type.</typeparam>\n        /// <param name="endpoint">The API endpoint.</param>\n        /// <param name="cancellationToken">The cancellation token.</param>\n        /// <returns>The deserialized response.</returns>\n        /// <exception cref="LawMaticsException">Thrown when the request fails.</exception>\n        public async Task<T> DeleteAsync<T>(string endpoint, CancellationToken cancellationToken = default)\n        {\n            return await SendRequestAsync<T>(HttpMethod.Delete, endpoint, null, cancellationToken);\n        }\n\n        private void SetupAuthentication()\n        {\n            if (!string.IsNullOrEmpty(Credentials.AccessToken))\n            {\n                _httpClient.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue(Credentials.TokenType, Credentials.AccessToken);\n            }\n        }\n\n        private async Task<T> SendRequestAsync<T>(HttpMethod method, string endpoint, object? content, CancellationToken cancellationToken)\n        {\n            if (_disposed)\n                throw new ObjectDisposedException(nameof(LawMaticsClient));\n\n            var url = _options.GetApiUrl(endpoint);\n\n            using var request = new HttpRequestMessage(method, url);\n\n            if (content != null)\n            {\n                var json = JsonSerializer.Serialize(content, _jsonOptions);\n                request.Content = new StringContent(json, Encoding.UTF8, "application/json");\n            }\n\n            _logger.LogDebug("Making {Method} request to {Url}", method.Method, url);\n\n            HttpResponseMessage response;\n            \n            try\n            {\n                response = await _httpClient.SendAsync(request, cancellationToken);\n            }\n            catch (HttpRequestException ex)\n            {\n                _logger.LogError(ex, "HTTP request failed for {Method} {Url}", method.Method, url);\n                throw new LawMaticsException($"HTTP request failed: {ex.Message}", ex);\n            }\n            catch (TaskCanceledException ex) when (!cancellationToken.IsCancellationRequested)\n            {\n                _logger.LogError(ex, "Request timed out for {Method} {Url}", method.Method, url);\n                throw new LawMaticsException($"Request timed out after {_options.TimeoutSeconds} seconds", ex);\n            }\n\n            await HandleErrorResponseAsync(response);\n\n            var responseContent = await response.Content.ReadAsStringAsync(cancellationToken);\n            \n            if (string.IsNullOrWhiteSpace(responseContent))\n            {\n                return default!;\n            }\n\n            try\n            {\n                var result = JsonSerializer.Deserialize<T>(responseContent, _jsonOptions);\n                _logger.LogDebug("Successfully deserialized response for {Method} {Url}", method.Method, url);\n                return result!;\n            }\n            catch (JsonException ex)\n            {\n                _logger.LogError(ex, "Failed to deserialize response for {Method} {Url}", method.Method, url);\n                throw new LawMaticsException($"Failed to deserialize API response: {ex.Message}", ex);\n            }\n        }\n\n        private async Task HandleErrorResponseAsync(HttpResponseMessage response)\n        {\n            if (response.IsSuccessStatusCode)\n                return;\n\n            var correlationId = response.Headers.TryGetValues("X-Correlation-ID", out var correlationValues) \n                ? correlationValues.FirstOrDefault() \n                : null;\n\n            string errorContent;\n            try\n            {\n                errorContent = await response.Content.ReadAsStringAsync();\n            }\n            catch\n            {\n                errorContent = string.Empty;\n            }\n\n            ApiErrorResponse? errorResponse = null;\n            string errorMessage = $"API request failed with status code {(int)response.StatusCode}";\n\n            try\n            {\n                if (!string.IsNullOrWhiteSpace(errorContent))\n                {\n                    errorResponse = JsonSerializer.Deserialize<ApiErrorResponse>(errorContent, _jsonOptions);\n                    errorMessage = errorResponse?.ErrorDescription ?? errorResponse?.Error ?? errorMessage;\n                }\n            }\n            catch\n            {\n                // If we can\'t deserialize the error response, use the status code message\n            }\n\n            var statusCode = (int)response.StatusCode;\n\n            switch (response.StatusCode)\n            {\n                case System.Net.HttpStatusCode.Unauthorized:\n                    throw new LawMaticsAuthenticationException(errorMessage, statusCode, errorResponse?.Error, correlationId);\n\n                case System.Net.HttpStatusCode.Forbidden:\n                    throw new LawMaticsAuthenticationException($"Access forbidden: {errorMessage}", statusCode, errorResponse?.Error, correlationId);\n\n                case System.Net.HttpStatusCode.TooManyRequests:\n                    var retryAfter = response.Headers.RetryAfter?.Delta?.TotalSeconds;\n                    throw new LawMaticsRateLimitException(errorMessage, statusCode, errorResponse?.Error, correlationId, retryAfter.HasValue ? (int)retryAfter.Value : null);\n\n                case System.Net.HttpStatusCode.NotFound:\n                    throw new LawMaticsNotFoundException(errorMessage, statusCode, errorResponse?.Error, correlationId);\n\n                default:\n                    throw new LawMaticsApiException(errorMessage, statusCode, errorResponse?.Error, correlationId, errorResponse);\n            }\n        }\n\n        private async Task<OAuthTokenResponse> RefreshTokenInternalAsync(CancellationToken cancellationToken)\n        {\n            var tokenRequest = new Dictionary<string, string>\n            {\n                ["grant_type"] = "refresh_token",\n                ["refresh_token"] = Credentials.RefreshToken!,\n                ["client_id"] = Credentials.ClientId!,\n                ["client_secret"] = Credentials.ClientSecret!\n            };\n\n            if (!string.IsNullOrEmpty(_options.RedirectUri))\n            {\n                tokenRequest["redirect_uri"] = _options.RedirectUri;\n            }\n\n            using var request = new HttpRequestMessage(HttpMethod.Post, _options.TokenUrl)\n            {\n                Content = new FormUrlEncodedContent(tokenRequest)\n            };\n\n            var response = await _httpClient.SendAsync(request, cancellationToken);\n            response.EnsureSuccessStatusCode();\n\n            var content = await response.Content.ReadAsStringAsync(cancellationToken);\n            return JsonSerializer.Deserialize<OAuthTokenResponse>(content, _jsonOptions)!;\n        }\n\n        /// <summary>\n        /// Releases all resources used by the <see cref="LawMaticsClient"/>.\n        /// </summary>\n        public void Dispose()\n        {\n            Dispose(true);\n            GC.SuppressFinalize(this);\n        }\n\n        /// <summary>\n        /// Releases the unmanaged resources used by the <see cref="LawMaticsClient"/> and optionally releases the managed resources.\n        /// </summary>\n        /// <param name="disposing">True to release both managed and unmanaged resources; false to release only unmanaged resources.</param>\n        protected virtual void Dispose(bool disposing)\n        {\n            if (!_disposed && disposing)\n            {\n                _httpClient?.Dispose();\n                _disposed = true;\n            }\n        }\n    }\n}\n</create-file>\n</function_calls>'}