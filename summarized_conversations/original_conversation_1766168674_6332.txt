{'role': 'assistant', 'content': '\nNow let me implement the CustomEmailsClient:\n\n<function_calls>\n<create-file file_path="LawMatics.SDK/Clients/CustomEmailsClient.cs">\nusing LawMatics.SDK.Configuration;\nusing LawMatics.SDK.Models;\nusing Microsoft.Extensions.Logging;\n\nnamespace LawMatics.SDK.Clients\n{\n    /// <summary>\n    /// Client for managing custom emails in the LawMatics API.\n    /// </summary>\n    public class CustomEmailsClient : BaseClient\n    {\n        public CustomEmailsClient(HttpClient httpClient, LawMaticsClientOptions options, ILogger<CustomEmailsClient> logger)\n            : base(httpClient, options, logger)\n        {\n        }\n\n        /// <summary>\n        /// Gets all custom emails with optional pagination and filtering.\n        /// </summary>\n        /// <param name="page">Page number for pagination (default: 1).</param>\n        /// <param name="pageSize">Number of items per page (default: 20).</param>\n        /// <param name="category">Filter by email category.</param>\n        /// <param name="isActive">Filter by active status.</param>\n        /// <param name="search">Search in name, subject, or body.</param>\n        /// <param name="cancellationToken">Cancellation token.</param>\n        /// <returns>A paged list of custom emails.</returns>\n        public async Task<PagedResponse<CustomEmail>> GetCustomEmailsAsync(\n            int page = 1,\n            int pageSize = 20,\n            string? category = null,\n            bool? isActive = null,\n            string? search = null,\n            CancellationToken cancellationToken = default)\n        {\n            var parameters = new Dictionary<string, string>\n            {\n                ["page"] = page.ToString(),\n                ["page_size"] = pageSize.ToString()\n            };\n\n            if (!string.IsNullOrEmpty(category))\n                parameters["category"] = category;\n\n            if (isActive.HasValue)\n                parameters["is_active"] = isActive.Value.ToString();\n\n            if (!string.IsNullOrEmpty(search))\n                parameters["search"] = search;\n\n            return await GetAsync<PagedResponse<CustomEmail>>("custom-emails", parameters, cancellationToken);\n        }\n\n        /// <summary>\n        /// Gets a specific custom email by ID.\n        /// </summary>\n        /// <param name="id">The custom email ID.</param>\n        /// <param name="cancellationToken">Cancellation token.</param>\n        /// <returns>The custom email details.</returns>\n        public async Task<CustomEmail?> GetCustomEmailAsync(int id, CancellationToken cancellationToken = default)\n        {\n            return await GetAsync<CustomEmail>($"custom-emails/{id}", cancellationToken: cancellationToken);\n        }\n\n        /// <summary>\n        /// Creates a new custom email.\n        /// </summary>\n        /// <param name="request">The custom email creation request.</param>\n        /// <param name="cancellationToken">Cancellation token.</param>\n        /// <returns>The created custom email.</returns>\n        public async Task<CustomEmail?> CreateCustomEmailAsync(CreateCustomEmailRequest request, CancellationToken cancellationToken = default)\n        {\n            return await PostAsync<CustomEmail>("custom-emails", request, cancellationToken);\n        }\n\n        /// <summary>\n        /// Updates an existing custom email.\n        /// </summary>\n        /// <param name="id">The custom email ID.</param>\n        /// <param name="request">The custom email update request.</param>\n        /// <param name="cancellationToken">Cancellation token.</param>\n        /// <returns>The updated custom email.</returns>\n        public async Task<CustomEmail?> UpdateCustomEmailAsync(int id, UpdateCustomEmailRequest request, CancellationToken cancellationToken = default)\n        {\n            return await PutAsync<CustomEmail>($"custom-emails/{id}", request, cancellationToken);\n        }\n\n        /// <summary>\n        /// Deletes a custom email.\n        /// </summary>\n        /// <param name="id">The custom email ID.</param>\n        /// <param name="cancellationToken">Cancellation token.</param>\n        /// <returns>True if deletion was successful.</returns>\n        public async Task<bool> DeleteCustomEmailAsync(int id, CancellationToken cancellationToken = default)\n        {\n            return await DeleteAsync($"custom-emails/{id}", cancellationToken);\n        }\n\n        /// <summary>\n        /// Sends a test email using a custom email template.\n        /// </summary>\n        /// <param name="id">The custom email ID.</param>\n        /// <param name="testEmail">The email address to send the test to.</param>\n        /// <param name="variables">Optional variables for template substitution.</param>\n        /// <param name="cancellationToken">Cancellation token.</param>\n        /// <returns>The result of the test send operation.</returns>\n        public async Task<EmailTestResult?> SendTestEmailAsync(\n            int id,\n            string testEmail,\n            Dictionary<string, object>? variables = null,\n            CancellationToken cancellationToken = default)\n        {\n            var request = new\n            {\n                test_email = testEmail,\n                variables = variables ?? new Dictionary<string, object>()\n            };\n\n            return await PostAsync<EmailTestResult>($"custom-emails/{id}/test", request, cancellationToken);\n        }\n\n        /// <summary>\n        /// Previews a custom email with optional variable substitution.\n        /// </summary>\n        /// <param name="id">The custom email ID.</param>\n        /// <param name="variables">Optional variables for template substitution.</param>\n        /// <param name="cancellationToken">Cancellation token.</param>\n        /// <returns>The email preview.</returns>\n        public async Task<CustomEmailPreview?> PreviewEmailAsync(\n            int id,\n            Dictionary<string, object>? variables = null,\n            CancellationToken cancellationToken = default)\n        {\n            var request = new\n            {\n                variables = variables ?? new Dictionary<string, object>()\n            };\n\n            return await PostAsync<CustomEmailPreview>($"custom-emails/{id}/preview", request, cancellationToken);\n        }\n\n        /// <summary>\n        /// Duplicates an existing custom email.\n        /// </summary>\n        /// <param name="id">The custom email ID to duplicate.</param>\n        /// <param name="newName">The name for the duplicated email.</param>\n        /// <param name="cancellationToken">Cancellation token.</param>\n        /// <returns>The duplicated custom email.</returns>\n        public async Task<CustomEmail?> DuplicateCustomEmailAsync(\n            int id,\n            string newName,\n            CancellationToken cancellationToken = default)\n        {\n            var request = new { name = newName };\n            return await PostAsync<CustomEmail>($"custom-emails/{id}/duplicate", request, cancellationToken);\n        }\n\n        /// <summary>\n        /// Gets custom emails by category.\n        /// </summary>\n        /// <param name="category">The email category.</param>\n        /// <param name="page">Page number for pagination (default: 1).</param>\n        /// <param name="pageSize">Number of items per page (default: 20).</param>\n        /// <param name="cancellationToken">Cancellation token.</param>\n        /// <returns>A paged list of custom emails in the specified category.</returns>\n        public async Task<PagedResponse<CustomEmail>> GetCustomEmailsByCategoryAsync(\n            string category,\n            int page = 1,\n            int pageSize = 20,\n            CancellationToken cancellationToken = default)\n        {\n            return await GetCustomEmailsAsync(page, pageSize, category: category, cancellationToken: cancellationToken);\n        }\n\n        /// <summary>\n        /// Gets active custom emails.\n        /// </summary>\n        /// <param name="page">Page number for pagination (default: 1).</param>\n        /// <param name="pageSize">Number of items per page (default: 20).</param>\n        /// <param name="cancellationToken">Cancellation token.</param>\n        /// <returns>A paged list of active custom emails.</returns>\n        public async Task<PagedResponse<CustomEmail>> GetActiveCustomEmailsAsync(\n            int page = 1,\n            int pageSize = 20,\n            CancellationToken cancellationToken = default)\n        {\n            return await GetCustomEmailsAsync(page, pageSize, isActive: true, cancellationToken: cancellationToken);\n        }\n\n        /// <summary>\n        /// Activates a custom email.\n        /// </summary>\n        /// <param name="id">The custom email ID.</param>\n        /// <param name="cancellationToken">Cancellation token.</param>\n        /// <returns>The updated custom email.</returns>\n        public async Task<CustomEmail?> ActivateCustomEmailAsync(int id, CancellationToken cancellationToken = default)\n        {\n            return await PostAsync<CustomEmail>($"custom-emails/{id}/activate", null, cancellationToken);\n        }\n\n        /// <summary>\n        /// Deactivates a custom email.\n        /// </summary>\n        /// <param name="id">The custom email ID.</param>\n        /// <param name="cancellationToken">Cancellation token.</param>\n        /// <returns>The updated custom email.</returns>\n        public async Task<CustomEmail?> DeactivateCustomEmailAsync(int id, CancellationToken cancellationToken = default)\n        {\n            return await PostAsync<CustomEmail>($"custom-emails/{id}/deactivate", null, cancellationToken);\n        }\n\n        /// <summary>\n        /// Gets available email categories.\n        /// </summary>\n        /// <param name="cancellationToken">Cancellation token.</param>\n        /// <returns>A list of email categories.</returns>\n        public async Task<List<string>> GetEmailCategoriesAsync(CancellationToken cancellationToken = default)\n        {\n            var response = await GetAsync<EmailCategoriesResponse>("custom-emails/categories", cancellationToken: cancellationToken);\n            return response?.Categories ?? new List<string>();\n        }\n\n        /// <summary>\n        /// Searches custom emails by keyword.\n        /// </summary>\n        /// <param name="query">Search query.</param>\n        /// <param name="page">Page number for pagination (default: 1).</param>\n        /// <param name="pageSize">Number of items per page (default: 20).</param>\n        /// <param name="cancellationToken">Cancellation token.</param>\n        /// <returns>A paged list of custom emails matching the search query.</returns>\n        public async Task<PagedResponse<CustomEmail>> SearchCustomEmailsAsync(\n            string query,\n            int page = 1,\n            int pageSize = 20,\n            CancellationToken cancellationToken = default)\n        {\n            return await GetCustomEmailsAsync(page, pageSize, search: query, cancellationToken: cancellationToken);\n        }\n\n        /// <summary>\n        /// Validates a custom email template syntax.\n        /// </summary>\n        /// <param name="subject">Email subject.</param>\n        /// <param name="body">Email body (HTML).</param>\n        /// <param name="bodyText">Email body (plain text).</param>\n        /// <param name="cancellationToken">Cancellation token.</param>\n        /// <returns>Validation result.</returns>\n        public async Task<EmailValidationResult?> ValidateEmailTemplateAsync(\n            string subject,\n            string body,\n            string? bodyText = null,\n            CancellationToken cancellationToken = default)\n        {\n            var request = new\n            {\n                subject,\n                body,\n                body_text = bodyText\n            };\n\n            return await PostAsync<EmailValidationResult>("custom-emails/validate", request, cancellationToken);\n        }\n\n        /// <summary>\n        /// Gets the merge variables available for email templates.\n        /// </summary>\n        /// <param name="context">The context (e.g., \'matter\', \'contact\', \'company\').</param>\n        /// <param name="cancellationToken">Cancellation token.</param>\n        /// <returns>A list of available merge variables.</returns>\n        public async Task<List<MergeVariable>> GetMergeVariablesAsync(\n            string context,\n            CancellationToken cancellationToken = default)\n        {\n            var parameters = new Dictionary<string, string>\n            {\n                ["context"] = context\n            };\n\n            var response = await GetAsync<MergeVariablesResponse>("custom-emails/merge-variables", parameters, cancellationToken);\n            return response?.Variables ?? new List<MergeVariable>();\n        }\n    }\n\n    /// <summary>\n    /// Response model for email categories.\n    /// </summary>\n    public class EmailCategoriesResponse\n    {\n        /// <summary>\n        /// Gets or sets the list of email categories.\n        /// </summary>\n        [System.Text.Json.Serialization.JsonPropertyName("categories")]\n        public List<string> Categories { get; set; } = new();\n    }\n\n    /// <summary>\n    /// Represents the result of an email test.\n    /// </summary>\n    public class EmailTestResult\n    {\n        /// <summary>\n        /// Gets or sets whether the test was successful.\n        /// </summary>\n        [System.Text.Json.Serialization.JsonPropertyName("success")]\n        public bool Success { get; set; }\n\n        /// <summary>\n        /// Gets or sets the message.\n        /// </summary>\n        [System.Text.Json.Serialization.JsonPropertyName("message")]\n        public string Message { get; set; } = string.Empty;\n\n        /// <summary>\n        /// Gets or sets the email ID that was sent.\n        /// </summary>\n        [System.Text.Json.Serialization.JsonPropertyName("email_id")]\n        public int? EmailId { get; set; }\n\n        /// <summary>\n        /// Gets or sets any errors that occurred.\n        /// </summary>\n        [System.Text.Json.Serialization.JsonPropertyName("errors")]\n        public List<string>? Errors { get; set; }\n    }\n\n    /// <summary>\n    /// Represents email validation result.\n    /// </summary>\n    public class EmailValidationResult\n    {\n        /// <summary>\n        /// Gets or sets whether the template is valid.\n        /// </summary>\n        [System.Text.Json.Serialization.JsonPropertyName("is_valid")]\n        public bool IsValid { get; set; }\n\n        /// <summary>\n        /// Gets or sets validation errors.\n        /// </summary>\n        [System.Text.Json.Serialization.JsonPropertyName("errors")]\n        public List<string> Errors { get; set; } = new();\n\n        /// <summary>\n        /// Gets or sets validation warnings.\n        /// </summary>\n        [System.Text.Json.Serialization.JsonPropertyName("warnings")]\n        public List<string> Warnings { get; set; } = new();\n\n        /// <summary>\n        /// Gets or sets found merge variables.\n        /// </summary>\n        [System.Text.Json.Serialization.JsonPropertyName("found_variables")]\n        public List<string> FoundVariables { get; set; } = new();\n\n        /// <summary>\n        /// Gets or sets undefined variables.\n        /// </summary>\n        [System.Text.Json.Serialization.JsonPropertyName("undefined_variables")]\n        public List<string> UndefinedVariables { get; set; } = new();\n    }\n\n    /// <summary>\n    /// Response model for merge variables.\n    /// </summary>\n    public class MergeVariablesResponse\n    {\n        /// <summary>\n        /// Gets or sets the list of merge variables.\n        /// </summary>\n        [System.Text.Json.Serialization.JsonPropertyName("variables")]\n        public List<MergeVariable> Variables { get; set; } = new();\n    }\n\n    /// <summary>\n    /// Represents a merge variable for email templates.\n    /// </summary>\n    public class MergeVariable\n    {\n        /// <summary>\n        /// Gets or sets the variable name.\n        /// </summary>\n        [System.Text.Json.Serialization.JsonPropertyName("name")]\n        public string Name { get; set; } = string.Empty;\n\n        /// <summary>\n        /// Gets or sets the variable description.\n        /// </summary>\n        [System.Text.Json.Serialization.JsonPropertyName("description")]\n        public string Description { get; set; } = string.Empty;\n\n        /// <summary>\n        /// Gets or sets the variable type.\n        /// </summary>\n        [System.Text.Json.Serialization.JsonPropertyName("type")]\n        public string Type { get; set; } = string.Empty;\n\n        /// <summary>\n        /// Gets or sets example value.\n        /// </summary>\n        [System.Text.Json.Serialization.JsonPropertyName("example")]\n        public string Example { get; set; } = string.Empty;\n\n        /// <summary>\n        /// Gets or sets whether the variable is required.\n        /// </summary>\n        [System.Text.Json.Serialization.JsonPropertyName("required")]\n        public bool Required { get; set; }\n    }\n}\n</create-file>\n</function_calls>'}