{'role': 'assistant', 'content': '\nNow let me create the ContactsClient class.\n\n<function_calls>\n<create-file file_path="LawMatics.SDK/Clients/ContactsClient.cs">\nusing System;\nusing System.Collections.Generic;\nusing System.Threading;\nusing System.Threading.Tasks;\nusing LawMatics.SDK.Models;\n\nnamespace LawMatics.SDK.Clients\n{\n    /// <summary>\n    /// Client for managing contacts in the LawMatics API.\n    /// </summary>\n    public class ContactsClient\n    {\n        private readonly LawMaticsClient _client;\n\n        /// <summary>\n        /// Initializes a new instance of the <see cref="ContactsClient"/> class.\n        /// </summary>\n        /// <param name="client">The LawMatics client instance.</param>\n        internal ContactsClient(LawMaticsClient client)\n        {\n            _client = client ?? throw new ArgumentNullException(nameof(client));\n        }\n\n        /// <summary>\n        /// Gets a list of contacts with optional filtering.\n        /// </summary>\n        /// <param name="parameters">The optional filter and pagination parameters.</param>\n        /// <param name="cancellationToken">The cancellation token.</param>\n        /// <returns>A paginated list of contacts.</returns>\n        /// <exception cref="LawMaticsException">Thrown when the API request fails.</exception>\n        public async Task<ApiResponse<List<Contact>>> GetContactsAsync(GetContactsParameters? parameters = null, CancellationToken cancellationToken = default)\n        {\n            var queryParams = BuildQueryParameters(parameters);\n            var endpoint = $"contacts{queryParams}";\n            \n            return await _client.GetAsync<ApiResponse<List<Contact>>>(endpoint, cancellationToken);\n        }\n\n        /// <summary>\n        /// Gets a contact by ID.\n        /// </summary>\n        /// <param name="id">The contact ID.</param>\n        /// <param name="cancellationToken">The cancellation token.</param>\n        /// <returns>The contact details.</returns>\n        /// <exception cref="LawMaticsException">Thrown when the API request fails.</exception>\n        /// <exception cref="LawMaticsNotFoundException">Thrown when the contact is not found.</exception>\n        public async Task<Contact> GetContactAsync(int id, CancellationToken cancellationToken = default)\n        {\n            if (id <= 0)\n                throw new ArgumentException("Contact ID must be greater than zero.", nameof(id));\n\n            var endpoint = $"contacts/{id}";\n            var response = await _client.GetAsync<ApiResponse<Contact>>(endpoint, cancellationToken);\n            \n            return response.Data ?? throw new LawMaticsNotFoundException("Contact not found.", 404, null, null, "Contact", id.ToString());\n        }\n\n        /// <summary>\n        /// Creates a new contact.\n        /// </summary>\n        /// <param name="contact">The contact data to create.</param>\n        /// <param name="cancellationToken">The cancellation token.</param>\n        /// <returns>The created contact details.</returns>\n        /// <exception cref="LawMaticsException">Thrown when the API request fails.</exception>\n        /// <exception cref="ArgumentNullException">Thrown when contact is null.</exception>\n        public async Task<Contact> CreateContactAsync(CreateContactRequest contact, CancellationToken cancellationToken = default)\n        {\n            if (contact == null)\n                throw new ArgumentNullException(nameof(contact));\n\n            // Validate required fields\n            if (string.IsNullOrWhiteSpace(contact.FirstName) && string.IsNullOrWhiteSpace(contact.LastName) && string.IsNullOrWhiteSpace(contact.Email))\n                throw new ArgumentException("At least one of first name, last name, or email must be provided.", nameof(contact));\n\n            var endpoint = "contacts";\n            var response = await _client.PostAsync<ApiResponse<Contact>>(endpoint, contact, cancellationToken);\n            \n            return response.Data ?? throw new LawMaticsException("Failed to create contact: No data returned from API.");\n        }\n\n        /// <summary>\n        /// Updates an existing contact.\n        /// </summary>\n        /// <param name="id">The contact ID.</param>\n        /// <param name="contact">The contact data to update.</param>\n        /// <param name="cancellationToken">The cancellation token.</param>\n        /// <returns>The updated contact details.</returns>\n        /// <exception cref="LawMaticsException">Thrown when the API request fails.</exception>\n        /// <exception cref="ArgumentNullException">Thrown when contact is null.</exception>\n        /// <exception cref="ArgumentException">Thrown when id is invalid.</exception>\n        public async Task<Contact> UpdateContactAsync(int id, CreateContactRequest contact, CancellationToken cancellationToken = default)\n        {\n            if (id <= 0)\n                throw new ArgumentException("Contact ID must be greater than zero.", nameof(id));\n\n            if (contact == null)\n                throw new ArgumentNullException(nameof(contact));\n\n            var endpoint = $"contacts/{id}";\n            var response = await _client.PutAsync<ApiResponse<Contact>>(endpoint, contact, cancellationToken);\n            \n            return response.Data ?? throw new LawMaticsException("Failed to update contact: No data returned from API.");\n        }\n\n        /// <summary>\n        /// Deletes a contact.\n        /// </summary>\n        /// <param name="id">The contact ID.</param>\n        /// <param name="cancellationToken">The cancellation token.</param>\n        /// <returns>True if the contact was deleted successfully.</returns>\n        /// <exception cref="LawMaticsException">Thrown when the API request fails.</exception>\n        /// <exception cref="ArgumentException">Thrown when id is invalid.</exception>\n        public async Task<bool> DeleteContactAsync(int id, CancellationToken cancellationToken = default)\n        {\n            if (id <= 0)\n                throw new ArgumentException("Contact ID must be greater than zero.", nameof(id));\n\n            var endpoint = $"contacts/{id}";\n            await _client.DeleteAsync<object>(endpoint, cancellationToken);\n            \n            return true;\n        }\n\n        /// <summary>\n        /// Finds contacts by name.\n        /// </summary>\n        /// <param name="name">The name to search for (can be first name, last name, or full name).</param>\n        /// <param name="parameters">Optional pagination parameters.</param>\n        /// <param name="cancellationToken">The cancellation token.</param>\n        /// <returns>A list of contacts matching the name.</returns>\n        /// <exception cref="LawMaticsException">Thrown when the API request fails.</exception>\n        /// <exception cref="ArgumentException">Thrown when name is null or empty.</exception>\n        public async Task<ApiResponse<List<Contact>>> FindContactsByNameAsync(string name, BaseRequestParameters? parameters = null, CancellationToken cancellationToken = default)\n        {\n            if (string.IsNullOrWhiteSpace(name))\n                throw new ArgumentException("Name cannot be null or empty.", nameof(name));\n\n            var queryParams = BuildQueryParameters(parameters);\n            var endpoint = $"contacts/find/name/{Uri.EscapeDataString(name)}{queryParams}";\n            \n            return await _client.GetAsync<ApiResponse<List<Contact>>>(endpoint, cancellationToken);\n        }\n\n        /// <summary>\n        /// Finds contacts by email address.\n        /// </summary>\n        /// <param name="email">The email address to search for.</param>\n        /// <param name="parameters">Optional pagination parameters.</param>\n        /// <param name="cancellationToken">The cancellation token.</param>\n        /// <returns>A list of contacts matching the email address.</returns>\n        /// <exception cref="LawMaticsException">Thrown when the API request fails.</exception>\n        /// <exception cref="ArgumentException">Thrown when email is null or empty.</exception>\n        public async Task<ApiResponse<List<Contact>>> FindContactsByEmailAsync(string email, BaseRequestParameters? parameters = null, CancellationToken cancellationToken = default)\n        {\n            if (string.IsNullOrWhiteSpace(email))\n                throw new ArgumentException("Email cannot be null or empty.", nameof(email));\n\n            var queryParams = BuildQueryParameters(parameters);\n            var endpoint = $"contacts/find/email/{Uri.EscapeDataString(email)}{queryParams}";\n            \n            return await _client.GetAsync<ApiResponse<List<Contact>>>(endpoint, cancellationToken);\n        }\n\n        /// <summary>\n        /// Finds contacts by phone number.\n        /// </summary>\n        /// <param name="phone">The phone number to search for.</param>\n        /// <param name="parameters">Optional pagination parameters.</param>\n        /// <param name="cancellationToken">The cancellation token.</param>\n        /// <returns>A list of contacts matching the phone number.</returns>\n        /// <exception cref="LawMaticsException">Thrown when the API request fails.</exception>\n        /// <exception cref="ArgumentException">Thrown when phone is null or empty.</exception>\n        public async Task<ApiResponse<List<Contact>>> FindContactsByPhoneAsync(string phone, BaseRequestParameters? parameters = null, CancellationToken cancellationToken = default)\n        {\n            if (string.IsNullOrWhiteSpace(phone))\n                throw new ArgumentException("Phone cannot be null or empty.", nameof(phone));\n\n            var queryParams = BuildQueryParameters(parameters);\n            var endpoint = $"contacts/find/phone/{Uri.EscapeDataString(phone)}{queryParams}";\n            \n            return await _client.GetAsync<ApiResponse<List<Contact>>>(endpoint, cancellationToken);\n        }\n\n        /// <summary>\n        /// Finds contacts by company.\n        /// </summary>\n        /// <param name="company">The company name to search for.</param>\n        /// <param name="parameters">Optional pagination parameters.</param>\n        /// <param name="cancellationToken">The cancellation token.</param>\n        /// <returns>A list of contacts matching the company.</returns>\n        /// <exception cref="LawMaticsException">Thrown when the API request fails.</exception>\n        /// <exception cref="ArgumentException">Thrown when company is null or empty.</exception>\n        public async Task<ApiResponse<List<Contact>>> FindContactsByCompanyAsync(string company, BaseRequestParameters? parameters = null, CancellationToken cancellationToken = default)\n        {\n            if (string.IsNullOrWhiteSpace(company))\n                throw new ArgumentException("Company cannot be null or empty.", nameof(company));\n\n            var queryParams = BuildQueryParameters(parameters);\n            var endpoint = $"contacts/find/company/{Uri.EscapeDataString(company)}{queryParams}";\n            \n            return await _client.GetAsync<ApiResponse<List<Contact>>>(endpoint, cancellationToken);\n        }\n\n        /// <summary>\n        /// Gets a count of contacts matching the specified filters.\n        /// </summary>\n        /// <param name="parameters">The optional filter parameters.</param>\n        /// <param name="cancellationToken">The cancellation token.</param>\n        /// <returns>The count of matching contacts.</returns>\n        /// <exception cref="LawMaticsException">Thrown when the API request fails.</exception>\n        public async Task<int> GetContactsCountAsync(GetContactsParameters? parameters = null, CancellationToken cancellationToken = default)\n        {\n            var queryParams = BuildQueryParameters(parameters);\n            var endpoint = $"contacts/count{queryParams}";\n            \n            var response = await _client.GetAsync<ApiResponse<Dictionary<string, object>>>(endpoint, cancellationToken);\n            \n            if (response.Data?.ContainsKey("count") == true)\n            {\n                if (response.Data["count"] is JsonElement element)\n                {\n                    return element.GetInt32();\n                }\n            }\n            \n            throw new LawMaticsException("Failed to get contacts count: Invalid response format.");\n        }\n\n        private string BuildQueryParameters(BaseRequestParameters? parameters)\n        {\n            if (parameters == null)\n                return string.Empty;\n\n            var queryParts = new List<string>();\n\n            // Base parameters\n            if (parameters.Page.HasValue)\n                queryParts.Add($"page={parameters.Page.Value}");\n\n            if (parameters.PerPage.HasValue)\n                queryParts.Add($"per_page={parameters.PerPage.Value}");\n\n            if (!string.IsNullOrEmpty(parameters.SortBy))\n                queryParts.Add($"sort_by={Uri.EscapeDataString(parameters.SortBy)}");\n\n            if (!string.IsNullOrEmpty(parameters.SortDirection))\n                queryParts.Add($"sort_direction={Uri.EscapeDataString(parameters.SortDirection)}");\n\n            if (parameters.Include != null && parameters.Include.Length > 0)\n                queryParts.Add($"include={string.Join(",", parameters.Select(Uri.EscapeDataString))}");\n\n            if (parameters.Exclude != null && parameters.Exclude.Length > 0)\n                queryParts.Add($"exclude={string.Join(",", parameters.Exclude.Select(Uri.EscapeDataString))}");\n\n            // Filter parameters (if it\'s a GetContactsParameters)\n            if (parameters is GetContactsParameters filterParams)\n            {\n                if (!string.IsNullOrEmpty(filterParams.Search))\n                    queryParts.Add($"search={Uri.EscapeDataString(filterParams.Search)}");\n\n                if (!string.IsNullOrEmpty(filterParams.FirstName))\n                    queryParts.Add($"first_name={Uri.EscapeDataString(filterParams.FirstName)}");\n\n                if (!string.IsNullOrEmpty(filterParams.LastName))\n                    queryParts.Add($"last_name={Uri.EscapeDataString(filterParams.LastName)}");\n\n                if (!string.IsNullOrEmpty(filterParams.Email))\n                    queryParts.Add($"email={Uri.EscapeDataString(filterParams.Email)}");\n\n                if (!string.IsNullOrEmpty(filterParams.Company))\n                    queryParts.Add($"company={Uri.EscapeDataString(filterParams.Company)}");\n\n                if (!string.IsNullOrEmpty(filterParams.ContactType))\n                    queryParts.Add($"contact_type={Uri.EscapeDataString(filterParams.ContactType)}");\n\n                if (!string.IsNullOrEmpty(filterParams.LeadStatus))\n                    queryParts.Add($"lead_status={Uri.EscapeDataString(filterParams.LeadStatus)}");\n\n                if (filterParams.AssignedUserId.HasValue)\n                    queryParts.Add($"assigned_user_id={filterParams.AssignedUserId.Value}");\n\n                if (!string.IsNullOrEmpty(filterParams.Source))\n                    queryParts.Add($"source={Uri.EscapeDataString(filterParams.Source)}");\n\n                if (filterParams.CreatedAfter.HasValue)\n                    queryParts.Add($"created_after={filterParams.CreatedAfter.Value:yyyy-MM-dd}");\n\n                if (filterParams.CreatedBefore.HasValue)\n                    queryParts.Add($"created_before={filterParams.CreatedBefore.Value:yyyy-MM-dd}");\n\n                if (filterParams.UpdatedAfter.HasValue)\n                    queryParts.Add($"updated_after={filterParams.UpdatedAfter.Value:yyyy-MM-dd}");\n\n                if (filterParams.UpdatedBefore.HasValue)\n                    queryParts.Add($"updated_before={filterParams.UpdatedBefore.Value:yyyy-MM-dd}");\n\n                if (filterParams.IsActive.HasValue)\n                    queryParts.Add($"is_active={filterParams.IsActive.Value.ToString().ToLowerInvariant()}");\n\n                if (filterParams.Filters != null)\n                {\n                    foreach (var filter in filterParams.Filters)\n                    {\n                        queryParts.Add($"{Uri.EscapeDataString(filter.Key)}={Uri.EscapeDataString(filter.Value?.ToString() ?? string.Empty)}");\n                    }\n                }\n            }\n\n            return queryParts.Count > 0 ? $"?{string.Join("&", queryParts)}" : string.Empty;\n        }\n    }\n}\n</create-file>\n</function_calls>'}