{'role': 'user', 'content': '<tool_result> <execute-command> ToolResult(success=True, output=\'{\\n  "output": "using LawMatics.SDK.Authentication;\\\\nusing LawMatics.SDK.Clients;\\\\nusing LawMatics.SDK.Configuration;\\\\nusing LawMatics.SDK.Exceptions;\\\\nusing LawMatics.SDK.Models;\\\\nusing Microsoft.Extensions.Logging;\\\\n\\\\nnamespace LawMatics.SDK\\\\n{\\\\n    /// <summary>\\\\n    /// Main client for interacting with the Lawmatics API\\\\n    /// </summary>\\\\n    public class LawMaticsClient : IDisposable\\\\n    {\\\\n        private readonly HttpClient _httpClient;\\\\n        private readonly LawMaticsClientOptions _options;\\\\n        private readonly ILogger? _logger;\\\\n        private readonly LawMaticsCredentials _credentials;\\\\n        private bool _disposed = false;\\\\n\\\\n        /// <summary>\\\\n        /// Gets the contacts client\\\\n        /// </summary>\\\\n        public ContactsClient Contacts { get; }\\\\n\\\\n        /// <summary>\\\\n        /// Gets the companies client\\\\n        /// </summary>\\\\n        public CompaniesClient Companies { get; }\\\\n\\\\n        /// <summary>\\\\n        /// Gets the matters client\\\\n        /// </summary>\\\\n        public MattersClient Matters { get; }\\\\n\\\\n        /// <summary>\\\\n        /// Gets the events client\\\\n        /// </summary>\\\\n        public EventsClient Events { get; }\\\\n\\\\n        /// <summary>\\\\n        /// Gets the files client\\\\n        /// </summary>\\\\n        public FilesClient Files { get; }\\\\n\\\\n        /// <summary>\\\\n        /// Gets the folders client\\\\n        /// </summary>\\\\n        public FoldersClient Folders { get; }\\\\n\\\\n        /// <summary>\\\\n        /// Gets the email campaigns client\\\\n        /// </summary>\\\\n        public EmailCampaignsClient EmailCampaigns { get; }\\\\n\\\\n        /// <summary>\\\\n        /// Gets the payments client\\\\n        /// </summary>\\\\n        public PaymentsClient Payments { get; }\\\\n\\\\n        /// <summary>\\\\n        /// Gets the custom fields client\\\\n        /// </summary>\\\\n        public CustomFieldsClient CustomFields { get; }\\\\n\\\\n        /// <summary>\\\\n        /// Gets the custom forms client\\\\n        /// </summary>\\\\n        public CustomFormsClient CustomForms { get; }\\\\n\\\\n        /// <summary>\\\\n        /// Gets the notes client\\\\n        /// </summary>\\\\n        public NotesClient Notes { get; }\\\\n\\\\n        /// <summary>\\\\n        /// Gets the users client\\\\n        /// </summary>\\\\n        public UsersClient Users { get; }\\\\n\\\\n        /// <summary>\\\\n        /// Initializes a new instance of the LawmaticsClient class\\\\n        /// </summary>\\\\n        /// <param name=\\\\"credentials\\\\">Authentication credentials</param>\\\\n        /// <param name=\\\\"options\\\\">Client configuration options</param>\\\\n        /// <param name=\\\\"logger\\\\">Optional logger</param>\\\\n        public LawMaticsClient(LawMaticsCredentials credentials, LawMaticsClientOptions? options = null, ILogger? logger = null)\\\\n        {\\\\n            _credentials = credentials ?? throw new ArgumentNullException(nameof(credentials));\\\\n            _options = options ?? LawMaticsClientOptions.Production;\\\\n            _logger = logger;\\\\n\\\\n            _httpClient = CreateHttpClient();\\\\n            \\\\n            // Initialize all client properties\\\\n            Contacts = new ContactsClient(_httpClient, _options, _logger);\\\\n            Companies = new CompaniesClient(_httpClient, _options, _logger);\\\\n            Matters = new MattersClient(_httpClient, _options, _logger);\\\\n            Events = new EventsClient(_httpClient, _options, _logger);\\\\n            Files = new FilesClient(_httpClient, _options, _logger);\\\\n            Folders = new FoldersClient(_httpClient, _options, _logger);\\\\n            EmailCampaigns = new EmailCampaignsClient(_httpClient, _options, _logger);\\\\n            Payments = new PaymentsClient(_httpClient, _options, _logger);\\\\n            CustomFields = new CustomFieldsClient(_httpClient, _options, _logger);\\\\n            CustomForms = new CustomFormsClient(_httpClient, _options, _logger);\\\\n            Notes = new NotesClient(_httpClient, _options, _logger);\\\\n            Users = new UsersClient(_httpClient, _options, _logger);\\\\n        }\\\\n\\\\n        /// <summary>\\\\n        /// Initializes a new instance of the LawmaticsClient class with API key authentication\\\\n        /// </summary>\\\\n        /// <param name=\\\\"apiKey\\\\">API key for authentication</param>\\\\n        /// <param name=\\\\"options\\\\">Client configuration options</param>\\\\n        /// <param name=\\\\"logger\\\\">Optional logger</param>\\\\n        public LawMaticsClient(string apiKey, LawMaticsClientOptions? options = null, ILogger? logger = null)\\\\n            : this(new LawMaticsCredentials(apiKey), options, logger)\\\\n        {\\\\n        }\\\\n\\\\n        /// <summary>\\\\n        /// Initializes a new instance of the LawmaticsClient class with custom HttpClient\\\\n        /// </summary>\\\\n        /// <param name=\\\\"credentials\\\\">Authentication credentials</param>\\\\n        /// <param name=\\\\"httpClient\\\\">Custom HttpClient</param>\\\\n        /// <param name=\\\\"options\\\\">Client configuration options</param>\\\\n        /// <param name=\\\\"logger\\\\">Optional logger</param>\\\\n        public LawMaticsClient(LawMaticsCredentials credentials, HttpClient httpClient, LawMaticsClientOptions? options = null, ILogger? logger = null)\\\\n        {\\\\n            _credentials = credentials ?? throw new ArgumentNullException(nameof(credentials));\\\\n            _httpClient = httpClient ?? throw new ArgumentNullException(nameof(httpClient));\\\\n            _options = options ?? LawMaticsClientOptions.Production;\\\\n            _logger = logger;\\\\n\\\\n            ConfigureHttpClient(_httpClient);\\\\n            \\\\n            // Initialize all client properties\\\\n            Contacts = new ContactsClient(_httpClient, _options, _logger);\\\\n            Companies = new CompaniesClient(_httpClient, _options, _logger);\\\\n            Matters = new MattersClient(_httpClient, _options, _logger);\\\\n            Events = new EventsClient(_httpClient, _options, _logger);\\\\n            Files = new FilesClient(_httpClient, _options, _logger);\\\\n            Folders = new FoldersClient(_httpClient, _options, _logger);\\\\n            EmailCampaigns = new EmailCampaignsClient(_httpClient, _options, _logger);\\\\n            Payments = new PaymentsClient(_httpClient, _options, _logger);\\\\n            CustomFields = new CustomFieldsClient(_httpClient, _options, _logger);\\\\n            CustomForms = new CustomFormsClient(_httpClient, _options, _logger);\\\\n            Notes = new NotesClient(_httpClient, _options, _logger);\\\\n            Users = new UsersClient(_httpClient, _options, _logger);\\\\n        }\\\\n\\\\n        private HttpClient CreateHttpClient()\\\\n        {\\\\n            var httpClient = new HttpClient();\\\\n            ConfigureHttpClient(httpClient);\\\\n            return httpClient;\\\\n        }\\\\n\\\\n        private void ConfigureHttpClient(HttpClient httpClient)\\\\n        {\\\\n            // Set base URL\\\\n            httpClient.BaseAddress = new Uri(_options.BaseUrl);\\\\n\\\\n            // Set timeout\\\\n            httpClient.Timeout = TimeSpan.FromSeconds(_options.TimeoutSeconds);\\\\n\\\\n            // Set authentication header\\\\n            if (!string.IsNullOrEmpty(_credentials.AccessToken))\\\\n            {\\\\n                httpClient.DefaultRequestHeaders.Authorization = \\\\n                    new System.Net.Http.Headers.AuthenticationHeaderValue(\\\\"Bearer\\\\", _credentials.AccessToken);\\\\n            }\\\\n\\\\n            // Set default headers\\\\n            httpClient.DefaultRequestHeaders.Add(\\\\"User-Agent\\\\", \\\\"LawMatics-SDK/1.0.0\\\\");\\\\n            httpClient.DefaultRequestHeaders.Add(\\\\"Accept\\\\", \\\\"application/json\\\\");\\\\n\\\\n            // Add custom headers\\\\n            foreach (var header in _options.CustomHeaders)\\\\n            {\\\\n                httpClient.DefaultRequestHeaders.Add(header.Key, header.Value);\\\\n            }\\\\n\\\\n            _logger?.LogDebug(\\\\"HttpClient configured with base URL: {BaseUrl}\\\\", _options.BaseUrl);\\\\n        }\\\\n\\\\n        /// <summary>\\\\n        /// Authenticate using OAuth 2.0 flow\\\\n        /// </summary>\\\\n        /// <param name=\\\\"clientId\\\\">OAuth client ID</param>\\\\n        /// <param name=\\\\"clientSecret\\\\">OAuth client secret</param>\\\\n        /// <param name=\\\\"authorizationCode\\\\">Authorization code</param>\\\\n        /// <param name=\\\\"redirectUri\\\\">Redirect URI (optional)</param>\\\\n        /// <returns>Authentication result</returns>\\\\n        public async Task<OAuthTokenResponse> AuthenticateAsync(string clientId, string clientSecret, string authorizationCode, string? redirectUri = null)\\\\n        {\\\\n            _logger?.LogInformation(\\\\"Starting OAuth authentication\\\\");\\\\n\\\\n            var tokenRequest = new Dictionary<string, string>\\\\n            {\\\\n                { \\\\"grant_type\\\\", \\\\"authorization_code\\\\" },\\\\n                { \\\\"client_id\\\\", clientId },\\\\n                { \\\\"client_secret\\\\", clientSecret },\\\\n                { \\\\"code\\\\", authorizationCode }\\\\n            };\\\\n\\\\n            if (!string.IsNullOrEmpty(redirectUri))\\\\n            {\\\\n                tokenRequest.Add(\\\\"redirect_uri\\\\", redirectUri);\\\\n            }\\\\n\\\\n            var content = new FormUrlEncodedContent(tokenRequest);\\\\n            var response = await _httpClient.PostAsync(\\\\"/oauth/token\\\\", content);\\\\n\\\\n            if (!response.IsSuccessStatusCode)\\\\n            {\\\\n                var errorContent = await response.Content.ReadAsStringAsync();\\\\n                throw new LawMaticsAuthenticationException($\\\\"Authentication failed: {errorContent}\\\\");\\\\n            }\\\\n\\\\n            var responseContent = await response.Content.ReadAsStringAsync();\\\\n            var tokenResponse = System.Text.Json.JsonSerializer.Deserialize<OAuthTokenResponse>(responseContent);\\\\n\\\\n            if (tokenResponse != null)\\\\n            {\\\\n                // Update credentials with new token\\\\n                _credentials.UpdateTokens(tokenResponse);\\\\n                \\\\n                // Update HttpClient header\\\\n                _httpClient.DefaultRequestHeaders.Authorization = \\\\n                    new System.Net.Http.Headers.AuthenticationHeaderValue(\\\\"Bearer\\\\", tokenResponse.AccessToken);\\\\n\\\\n                _logger?.LogInformation(\\\\"Authentication successful\\\\");\\\\n            }\\\\n\\\\n            return tokenResponse ?? throw new LawMaticsException(\\\\"Failed to parse authentication response\\\\");\\\\n        }\\\\n\\\\n        /// <summary>\\\\n        /// Refresh the access token\\\\n        /// </summary>\\\\n        /// <returns>New token response</returns>\\\\n        public async Task<OAuthTokenResponse> RefreshTokenAsync()\\\\n        {\\\\n            if (string.IsNullOrEmpty(_credentials.RefreshToken))\\\\n            {\\\\n                throw new LawMaticsAuthenticationException(\\\\"No refresh token available\\\\");\\\\n            }\\\\n\\\\n            _logger?.LogInformation(\\\\"Refreshing access token\\\\");\\\\n\\\\n            var tokenRequest = new Dictionary<string, string>\\\\n            {\\\\n                { \\\\"grant_type\\\\", \\\\"refresh_token\\\\" },\\\\n                { \\\\"refresh_token\\\\", _credentials.RefreshToken }\\\\n            };\\\\n\\\\n            if (!string.IsNullOrEmpty(_credentials.ClientId))\\\\n            {\\\\n                tokenRequest.Add(\\\\"client_id\\\\", _credentials.ClientId);\\\\n                tokenRequest.Add(\\\\"client_secret\\\\", _credentials.ClientSecret ?? \\\\"\\\\");\\\\n            }\\\\n\\\\n            var content = new FormUrlEncodedContent(tokenRequest);\\\\n            var response = await _httpClient.PostAsync(\\\\"/oauth/token\\\\", content);\\\\n\\\\n            if (!response.IsSuccessStatusCode)\\\\n            {\\\\n                var errorContent = await response.Content.ReadAsStringAsync();\\\\n                throw new LawMaticsAuthenticationException($\\\\"Token refresh failed: {errorContent}\\\\");\\\\n            }\\\\n\\\\n            var responseContent = await response.Content.ReadAsStringAsync();\\\\n            var tokenResponse = System.Text.Json.JsonSerializer.Deserialize<OAuthTokenResponse>(responseContent);\\\\n\\\\n            if (tokenResponse != null)\\\\n            {\\\\n                // Update credentials with new token\\\\n                _credentials.UpdateTokens(tokenResponse);\\\\n                \\\\n                // Update HttpClient header\\\\n                _httpClient.DefaultRequestHeaders.Authorization = \\\\n                    new System.Net.Http.Headers.AuthenticationHeaderValue(\\\\"Bearer\\\\", tokenResponse.AccessToken);\\\\n\\\\n                _logger?.LogInformation(\\\\"Token refreshed successfully\\\\");\\\\n            }\\\\n\\\\n            return tokenResponse ?? throw new LawMaticsException(\\\\"Failed to parse token refresh response\\\\");\\\\n        }\\\\n\\\\n        /// <summary>\\\\n        /// Test the connection to the API\\\\n        /// </summary>\\\\n        /// <returns>True if connection is successful</returns>\\\\n        public async Task<bool> TestConnectionAsync()\\\\n        {\\\\n            try\\\\n            {\\\\n                _logger?.LogDebug(\\\\"Testing API connection\\\\");\\\\n\\\\n                // Try to get current user as a simple connection test\\\\n                var response = await _httpClient.GetAsync(\\\\"/users/me\\\\");\\\\n                \\\\n                if (response.StatusCode == System.Net.HttpStatusCode.Unauthorized && \\\\n                    !string.IsNullOrEmpty(_credentials.RefreshToken))\\\\n                {\\\\n                    // Try to refresh token and retry\\\\n                    await RefreshTokenAsync();\\\\n                    response = await _httpClient.GetAsync(\\\\"/users/me\\\\");\\\\n                }\\\\n\\\\n                var success = response.IsSuccessStatusCode;\\\\n                _logger?.LogDebug(\\\\"Connection test result: {Success}\\\\", success);\\\\n                \\\\n                return success;\\\\n            }\\\\n            catch (Exception ex)\\\\n            {\\\\n                _logger?.LogError(ex, \\\\"Connection test failed\\\\");\\\\n                return false;\\\\n            }\\\\n        }\\\\n\\\\n        /// <summary>\\\\n        /// Get API version information\\\\n        /// </summary>\\\\n        /// <returns>API version information</returns>\\\\n        public async Task<object> GetApiVersionAsync()\\\\n        {\\\\n            var response = await _httpClient.GetAsync(\\\\"/version\\\\");\\\\n            response.EnsureSuccessStatusCode();\\\\n            \\\\n            var content = await response.Content.ReadAsStringAsync();\\\\n            return System.Text.Json.JsonSerializer.Deserialize<object>(content) ?? new { };\\\\n        }\\\\n\\\\n        /// <summary>\\\\n        /// Get account information\\\\n        /// </summary>\\\\n        /// <returns>Account information</returns>\\\\n        public async Task<object> GetAccountInfoAsync()\\\\n        {\\\\n            var response = await _httpClient.GetAsync(\\\\"/account\\\\");\\\\n            response.EnsureSuccessStatusCode();\\\\n            \\\\n            var content = await response.Content.ReadAsStringAsync();\\\\n            return System.Text.Json.JsonSerializer.Deserialize<object>(content) ?? new { };\\\\n        }\\\\n\\\\n        /// <summary>\\\\n        /// Dispose of the client\\\\n        /// </summary>\\\\n        public void Dispose()\\\\n        {\\\\n            Dispose(true);\\\\n            GC.SuppressFinalize(this);\\\\n        }\\\\n\\\\n        protected virtual void Dispose(bool disposing)\\\\n        {\\\\n            if (!_disposed && disposing)\\\\n            {\\\\n                _httpClient?.Dispose();\\\\n                _disposed = true;\\\\n                _logger?.LogDebug(\\\\"LawMaticsClient disposed\\\\");\\\\n            }\\\\n        }\\\\n    }\\\\n}",\\n  "exit_code": 0,\\n  "cwd": "/workspace"\\n}\') </execute-command> </tool_result>'}